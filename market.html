<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Elytopia — Магазин</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div aria-hidden="true" class="brand-logo"></div>
        <h1>Elytopia</h1>
      </div>
      <nav>
        <a href="index.html" class="btn ghost">Главная</a>
        <a href="login.html" class="btn ghost">Вход</a>
        <a href="signup.html" class="btn ghost">Регистрация</a>
      </nav>
    </header>

    <main class="grid">
      <!-- Currency display -->
      <section class="card" style="grid-column: span 12;">
        <h2>Магазин паков</h2>
        <p class="muted">Вы получаете <strong>25 монет</strong> каждые 2 секунды. Каждый пак стоит 25 монет.</p>
        <div class="row" style="justify-content: space-between; align-items: center;">
          <div><strong>Ваш баланс:</strong> <span id="currency">0</span> монет</div>
          <button class="btn warning" id="reset">Сбросить баланс</button>
        </div>
      </section>

      <!-- Packs grid -->
      <section class="card" style="grid-column: span 12;">
        <div class="mode-grid" id="packs"></div>
      </section>

      <!-- Result + history -->
      <section class="card" style="grid-column: span 12;">
        <h2>Результат открытия</h2>
        <div id="result" class="muted">Пока ничего не открыто.</div>
        <h3 style="margin-top:16px;">История открытий</h3>
        <ul id="history" class="muted"></ul>
      </section>
    </main>

    <footer>
      <div>© Elytopia</div>
    </footer>
  </div>

  <script>
    // --- Currency ---
    let coins = 0;
    const currencyEl = document.getElementById("currency");
    setInterval(() => {
      coins += 25;
      currencyEl.textContent = coins;
    }, 2000);

    document.getElementById("reset").onclick = () => {
      coins = 0;
      currencyEl.textContent = coins;
      document.getElementById("history").innerHTML = "";
      document.getElementById("result").textContent = "Баланс сброшен.";
    };

    // --- Packs ---
    const packsContainer = document.getElementById("packs");
    const resultEl = document.getElementById("result");
    const historyEl = document.getElementById("history");

    const packs = Array.from({length: 13}, (_, i) => ({
      id: i+1,
      name: "Пак #" + (i+1)
    }));

    packs.forEach(pack => {
      const div = document.createElement("div");
      div.className = "mode";
      div.innerHTML = `
        <h3>${pack.name}</h3>
        <p>Цена: 25 монет</p>
        <button class="btn" data-pack="${pack.id}">Открыть</button>
      `;
      packsContainer.appendChild(div);
    });

    // --- Rarity system with exact chances ---
    const rarities = [
      { name: "Uncommon", chance: 19, color: "#4caf50" },
      { name: "Rare", chance: 7, color: "#2196f3" },
      { name: "Epic", chance: 5, color: "#9c27b0" },
      { name: "Legendary", chance: 0.3, color: "#ff9800" },
      { name: "Chroma", chance: 0.05, color: "#e91e63" },
      { name: "Supreme", chance: 0.04, color: "#00bcd4" },
      { name: "Mythical", chance: 0.01, color: "#f44336" }
    ];

    function rollRarity() {
      const roll = Math.random() * 100;
      let cumulative = 0;
      for (const r of rarities) {
        cumulative += r.chance;
        if (roll <= cumulative) return r;
      }
      return rarities[0]; // fallback
    }

    // --- Pack opening ---
    packsContainer.addEventListener("click", e => {
      if (e.target.matches("[data-pack]")) {
        if (coins < 25) {
          resultEl.textContent = "Недостаточно монет!";
          return;
        }
        coins -= 25;
        currencyEl.textContent = coins;
        const rarity = rollRarity();
        resultEl.innerHTML = `Вы открыли пак и получили: 
          <span style="color:${rarity.color}; font-weight:bold">${rarity.name}</span>`;
        const li = document.createElement("li");
        li.innerHTML = `<span style="color:${rarity.color}; font-weight:bold">${rarity.name}</span>`;
        historyEl.appendChild(li);
      }
    });
  </script>
</body>
</html>
